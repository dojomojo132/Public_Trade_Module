# Функции сериализации/десериализации в 1С:Предприятие 8.3

## ⚠️ ВАЖНО: Правильные имена функций

В 1С 8.3 для работы с внутренним представлением используются функции:

| ❌ НЕ СУЩЕСТВУЕТ | ✅ ПРАВИЛЬНО | Описание |
|------------------|--------------|----------|
| `ЗначениеВСтроку()` | `ЗначениеВСтрокуВнутр()` | Сериализация в строку |
| `СтрокаВЗначение()` | `ЗначениеИзСтрокиВнутр()` | Десериализация из строки |

## Синтаксис

### ЗначениеВСтрокуВнутр(Значение)

Преобразует значение в строковое представление во внутреннем формате 1С.

```bsl
СтрокаСсылки = ЗначениеВСтрокуВнутр(СправочникСсылка);
// Результат: "{&Справочник.Номенклатура,01,1,1}"

СтрокаЧисла = ЗначениеВСтрокуВнутр(125);
// Результат: "125"

СтрокаБулево = ЗначениеВСтрокуВнутр(Истина);
// Результат: "Истина"

СтрокаДаты = ЗначениеВСтрокуВнутр(Дата(2026,1,29));
// Результат: "{&ДатаВремя,01,1,1,29,1,2026}"
```

### ЗначениеИзСтрокиВнутр(Строка)

Восстанавливает значение из строкового представления.

```bsl
ВосстановленнаяСсылка = ЗначениеИзСтрокиВнутр("{&Справочник.Номенклатура,01,1,1}");
// Результат: СправочникСсылка.Номенклатура

ВосстановленноеЧисло = ЗначениеИзСтрокиВнутр("125");
// Результат: 125

ВосстановленноеБулево = ЗначениеИзСтрокиВнутр("Истина");
// Результат: Истина
```

## Применение

### Сохранение в базу данных

```bsl
Процедура СохранитьЗначение(Ключ, Значение)
    Менеджер = РегистрыСведений.НастройкиПоУмолчанию.СоздатьМенеджерЗаписи();
    Менеджер.Ключ = Ключ;
    Менеджер.Значение = ЗначениеВСтрокуВнутр(Значение);
    Менеджер.Записать();
КонецПроцедуры
```

### Чтение из базы данных

```bsl
Функция ПрочитатьЗначение(Ключ)
    Запрос = Новый Запрос;
    Запрос.Текст = "ВЫБРАТЬ Значение ИЗ РегистрСведений.НастройкиПоУмолчанию ГДЕ Ключ = &Ключ";
    Запрос.УстановитьПараметр("Ключ", Ключ);
    
    Результат = Запрос.Выполнить();
    Если Результат.Пустой() Тогда
        Возврат Неопределено;
    КонецЕсли;
    
    Выборка = Результат.Выбрать();
    Выборка.Следующий();
    
    Возврат ЗначениеИзСтрокиВнутр(Выборка.Значение);
КонецФункции
```

## Альтернативы

### XMLString / XMLValue (для XML)

Используются для сериализации в XML-формат:

```bsl
СтрокаXML = XMLString(Значение);
ВосстановленноеЗначение = XMLValue(Тип("Дата"), СтрокаXML);
```

**Различия:**
- `ЗначениеВСтрокуВнутр/ЗначениеИзСтрокиВнутр` — внутренний формат 1С (компактный)
- `XMLString/XMLValue` — XML-формат (читаемый, но объёмный)

### ЗаписатьJSON / ПрочитатьJSON

Для сериализации в JSON (1С 8.3.10+):

```bsl
ЗаписьJSON = Новый ЗаписьJSON;
ЗаписьJSON.УстановитьСтроку();
ЗаписатьJSON(ЗаписьJSON, Значение);
СтрокаJSON = ЗаписьJSON.Закрыть();
```

## Рекомендации

✅ **Используйте `ЗначениеВСтрокуВнутр/ЗначениеИзСтрокиВнутр` для:**
- Хранения произвольных значений в строковых полях БД
- Передачи данных между клиентом и сервером
- Кеширования сложных структур

❌ **НЕ используйте для:**
- Обмена данными с внешними системами (лучше JSON/XML)
- Долговременного архивного хранения (формат может измениться между версиями)

## Обработка ошибок

```bsl
Попытка
    ВосстановленноеЗначение = ЗначениеИзСтрокиВнутр(СтрокаЗначения);
Исключение
    // Строка содержит некорректные данные
    ВосстановленноеЗначение = Неопределено;
КонецПопытки;
```

## Пример использования в PTM

См. реализацию в модуле [НастройкиПоУмолчанию](../Конфигурация/CommonModules/НастройкиПоУмолчанию/Ext/Module.bsl):

- Строка 182: `ЗначениеВСтрокуВнутр()`
- Строка 227: `ЗначениеИзСтрокиВнутр()`

---

**Дата:** 29.01.2026  
**Версия:** 1С:Предприятие 8.3.27
