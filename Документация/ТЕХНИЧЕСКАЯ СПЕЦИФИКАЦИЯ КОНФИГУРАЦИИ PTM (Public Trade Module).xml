<?xml version="1.0" encoding="UTF-8"?>
<Configuration name="PTM - Public Trade Module" version="1.0.3" country="Ukraine">

    <Description>
        Полная техническая спецификация конфигурации.
        Является ЕДИНЫМ ИСТОЧНИКОМ ПРАВДЫ для разработки.
	</Description>

    <Catalogs>
		<Object name="Номенклатура" synonym="Товары и услуги">
			
			<Block name="Purpose">
				<Content>
					Центральный справочник для хранения информации о товарах и услугах. 
					Используется во всех товароучетных документах и РМК.
				</Content>
			</Block>

			<Block name="DataModel">
				<Fields>
					<Field name="Артикул" type="Строка(25)">Уникальный артикул производителя.</Field>
					<Field name="Код" type="Строка(11)">Внутренний код (генерируется автоматически).</Field>
					<Field name="ВидНоменклатуры" type="Перечисление.ВидыНоменклатуры">Товар / Услуга.</Field>
					<Field name="СтавкаНДС" type="Перечисление.СтавкиНДС">20%, 7%, 0%, Без НДС.</Field>
					<Field name="КодУКТЗЕД" type="Строка(20)">Код ВЭД (Обязателен для акцизных товаров в Украине).</Field>
					<Field name="ТребуетАкцизнуюМарку" type="Булево">Флаг контроля маркировки в РМК.</Field>
					<Field name="НалоговаяГруппа" type="Справочник.НалоговыеГруппы">Группа налогообложения для ПРРО.</Field>
				</Fields>
			</Block>

			<Block name="Logic">
				<Items>
					<Item event="ПередЗаписью">
						Автозаполнение: Если поле "Артикул" не заполнено, в него копируется значение поля "Код".
					</Item>
					<Item event="Контроль">
						При установке флага "ТребуетАкцизнуюМарку" проверка заполненности "КодУКТЗЕД".
					</Item>
				</Items>
			</Block>

			<Block name="Interface">
				<Items>
					<Item>
						Форма списка: Реализован быстрый поиск по вхождению строки в Наименование/Артикул/Штрихкод.
					</Item>
				</Items>
			</Block>

			<Block name="History">
				<Record date="2025-10-15">Реализовано автозаполнение Артикула из Кода.</Record>
				<Record date="2025-10-20">Добавлены реквизиты для ПРРО (КодУКТЗЕД, НалоговаяГруппа).</Record>
			</Block>
		</Object>

		<Object name="Кассы" synonym="Кассовые аппараты">
			
			<Block name="Purpose">
				<Content>
					Места проведения расчетов. Разделяет денежные потоки и смены по физическим устройствам.
				</Content>
			</Block>

			<Block name="DataModel">
				<Fields>
					<Field name="Наименование" type="Строка(50)">Название кассы (пр. "Касса №1").</Field>
					<Field name="ФискальныйНомерПРРО" type="Строка(20)">ID кассы на сервере налоговой (опционально).</Field>
				</Fields>
			</Block>

			<Block name="Logic">
				<Items>
					<Item>Используется как разделитель учета в регистре "ДенежныеСредства".</Item>
					<Item>Обязателен для заполнения в документе "КассоваяСмена".</Item>
				</Items>
			</Block>

			<Block name="History">
				<Record date="2025-10-01">Создание базовой структуры.</Record>
			</Block>
		</Object>

		<Object name="Склады" synonym="Склады и магазины">
			<Block name="Purpose">
				<Content>Места хранения товарных остатков.</Content>
			</Block>
			<Block name="DataModel">
				<Fields>
					<Field name="ТипСклада" type="Перечисление.ТипыСкладов">Розничный / Оптовый.</Field>
				</Fields>
			</Block>
			<Block name="Logic">
				<Items>
					<Item>Разделитель учета в регистре "ОстаткиТоваров".</Item>
				</Items>
			</Block>
			<Block name="History">
				<Record date="2025-10-01">Создание базовой структуры.</Record>
			</Block>
		</Object>

		<Object name="НалоговыеГруппы" synonym="Налоговые группы (ПРРО)">
			<Block name="Purpose">
				<Content>
					Хранение буквенных обозначений ставок НДС для фискального чека (А, Б, В...).
					Необходимо для маппинга ставок 1С на ставки фискального регистратора.
				</Content>
			</Block>
			<Block name="DataModel">
				<Fields>
					<Field name="Буква" type="Строка(1)">Код ставки (А, Б, В, Г...).</Field>
					<Field name="Ставка" type="Число(5,2)">Процент налога.</Field>
				</Fields>
			</Block>
			<Block name="History">
				<Record date="2025-10-20">Добавлен в рамках адаптации под законодательство Украины.</Record>
			</Block>
		</Object>
		
	</Catalogs>

    <Documents>
		<Object name="КассоваяСмена" synonym="Кассовая смена">
        
        <Block name="Purpose">
            <Content>
                Документ, фиксирующий период работы кассы (аналог Z-отчета). 
                Ограничивает возможность пробития чеков: чеки можно бить только в рамках ОТКРЫТОЙ смены.
            </Content>
        </Block>

        <Block name="DataModel">
            <Fields>
                <Field type="Header" name="Касса" type_val="Справочник.Кассы">Физическая касса, по которой открыта смена.</Field>
                <Field type="Header" name="ДатаНачала" type_val="Дата">Время открытия смены.</Field>
                <Field type="Header" name="ДатаОкончания" type_val="Дата">Время закрытия смены.</Field>
                <Field type="Header" name="Статус" type_val="Перечисление.СтатусыКассовойСмены">Значения: Открыта, Закрыта.</Field>
            </Fields>
        </Block>

        <Block name="Logic">
            <Items>
                <Item event="Контроль">
                    Запрещено проведение двух открытых смен по одной Кассе одновременно.
                </Item>
                <Item event="РМК">
                    При запуске РМК ищется смена со статусом "Открыта". Если не найдена — предлагается создать новую.
                </Item>
            </Items>
        </Block>

        <Block name="History">
            <Record date="2025-10-01">Создание объекта.</Record>
            <Record date="2026-01-15">Изменение типа "Статус" со Строки на Перечисление. Переименование "КассаККМ" -> "Касса".</Record>
        </Block>
    </Object>

		<Object name="ЧекККМ" synonym="Розничный чек">
			
			<Block name="Purpose">
				<Content>
					Фиксация факта розничной продажи. Списывает товары со склада, фиксирует выручку и генерирует фискальный номер.
				</Content>
			</Block>

			<Block name="DataModel">
				<Fields>
					<Field type="Header" name="КассоваяСмена" type_val="Документ.КассоваяСмена">Связь со сменой.</Field>
					<Field type="Header" name="Касса" type_val="Справочник.Кассы">Касса пробития.</Field>
					<Field type="Header" name="Склад" type_val="Справочник.Склады">Склад списания остатков.</Field>
					<Field type="Header" name="СуммаДокумента" type_val="Число(15,2)">Итоговая сумма.</Field>
					<Field type="Header" name="ФискальныйНомер" type_val="Строка(50)">Уникальный номер от сервера ПРРО/ГНС.</Field>
					<Field type="Header" name="Статус" type_val="Перечисление.СтатусыЧекаККМ">Пробит, Аннулирован, Отложен.</Field>
					
					<Field type="TabularSection" name="Товары.Номенклатура" type_val="Справочник.Номенклатура">Товар.</Field>
					<Field type="TabularSection" name="Товары.Количество" type_val="Число(15,3)">Количество.</Field>
					<Field type="TabularSection" name="Товары.Цена" type_val="Число(15,2)">Цена продажи.</Field>
					<Field type="TabularSection" name="Товары.Сумма" type_val="Число(15,2)">Сумма строки.</Field>
					<Field type="TabularSection" name="Товары.АкцизнаяМарка" type_val="Строка(200)">Код маркировки (Обязателен для акциза).</Field>
					<Field type="TabularSection" name="Товары.НалоговаяГруппа" type_val="Справочник.НалоговыеГруппы">Ставка НДС для чека.</Field>

					<Field type="TabularSection" name="Оплата.ВидОплаты" type_val="Перечисление.ВидыОплаты">Наличные / Карта.</Field>
					<Field type="TabularSection" name="Оплата.Сумма" type_val="Число(15,2)">Сумма оплаты.</Field>
				</Fields>
			</Block>

			<Block name="Logic">
				<Items>
					<Item event="ОбработкаПроведения">
						Формирует движения: Расход по регистру "ОстаткиТоваров", Приход по регистру "Продажи".
					</Item>
					<Item event="Контроль">
						Если товар имеет флаг "ТребуетАкцизнуюМарку", поле "Товары.АкцизнаяМарка" должно быть заполнено.
					</Item>
				</Items>
			</Block>

			<Block name="Interface">
				<Items>
					<Item>Основная форма работы — Обработка "РабочееМестоКассира" (РМК), а не форма документа.</Item>
					<Item>Перед пробитием вызывается диалог выбора метода оплаты (Нал/Карта).</Item>
				</Items>
			</Block>

			<Block name="History">
				<Record date="2025-10-10">Базовая версия.</Record>
				<Record date="2026-01-15">Адаптация под Украину: Добавлены поля "ФискальныйНомер" (вместо Признака), "АкцизнаяМарка", "НалоговаяГруппа".</Record>
			</Block>
		</Object>
	
	</Documents>

    <Enums>
	
		<Object name="ВидыНоменклатуры" synonym="Виды номенклатуры">
			<Block name="Purpose"><Content>Разделение типов запасов.</Content></Block>
			<Block name="DataModel">
				<Fields><Field name="Значения">Товар, Услуга.</Field></Fields>
			</Block>
		</Object>

		<Object name="СтавкиНДС" synonym="Ставки НДС">
			<Block name="Purpose"><Content>Ставки налогообложения (Адаптация: Украина).</Content></Block>
			<Block name="DataModel">
				<Fields><Field name="Значения">НДС20 (20%), НДС7 (7%), НДС0 (0%), БезНДС.</Field></Fields>
			</Block>
			<Block name="History"><Record date="2026-01-15">Добавлены ставки 7% и 0%.</Record></Block>
		</Object>

		<Object name="СтатусыЧекаККМ" synonym="Статусы чека">
			<Block name="Purpose"><Content>Жизненный цикл чека.</Content></Block>
			<Block name="DataModel">
				<Fields><Field name="Значения">Пробит, Отложен, Аннулирован.</Field></Fields>
			</Block>
		</Object>
    
		<Object name="СтатусыКассовойСмены" synonym="Статусы смены">
			<Block name="Purpose"><Content>Жизненный цикл смены (Z-отчет).</Content></Block>
			<Block name="DataModel">
				<Fields><Field name="Значения">Открыта, Закрыта.</Field></Fields>
			</Block>
			<Block name="History"><Record date="2026-01-15">Объект создан для исправления ошибки типизации в РМК.</Record></Block>
		</Object>

		<Object name="ВидыОплаты" synonym="Виды оплаты">
			<Block name="Purpose"><Content>Способы расчета.</Content></Block>
			<Block name="DataModel">
				<Fields><Field name="Значения">Наличные, Карта.</Field></Fields>
			</Block>
		</Object>

    
	</Enums>

    <DataProcessors>
		<Object name="РабочееМестоКассира" synonym="РМК (Касса)">
        
			<Block name="Purpose">
				<Content>
					Основной рабочий интерфейс кассира. Обеспечивает подбор товаров, расчет скидок (в перспективе) 
					и оформление чеков без прямого доступа к документам.
				</Content>
			</Block>

			<Block name="DataModel">
				<Fields>
					<Field type="Header" name="Касса" type_val="Справочник.Кассы">Контекст: Текущая касса сеанса.</Field>
					<Field type="Header" name="КассоваяСмена" type_val="Документ.КассоваяСмена">Контекст: Текущая открытая смена.</Field>
					<Field type="TabularSection" name="ТЧ.Номенклатура" type_val="Справочник.Номенклатура">Товар в корзине.</Field>
					<Field type="TabularSection" name="ТЧ.Количество" type_val="Число">Количество.</Field>
					<Field type="TabularSection" name="ТЧ.Цена" type_val="Число">Цена продажи.</Field>
					<Field type="TabularSection" name="ТЧ.Сумма" type_val="Число">Сумма строки.</Field>
					<Field type="TabularSection" name="ТЧ.АкцизнаяМарка" type_val="Строка(200)">Введенный код маркировки.</Field>
				</Fields>
			</Block>

			<Block name="Logic">
				<Items>
					<Item event="ПриОткрытии">
						Проверка наличия открытой смены. Если нет — диалог "Открыть смену?". 
						Если отказ — работа блокируется.
					</Item>
					<Item event="ПодборТовара">
						Используется глобальный поиск (Штрихкод -> Артикул).
						Если товар требует акциз (`Номенклатура.ТребуетАкцизнуюМарку`), открывается окно ввода марки.
						Товар без марки в чек не добавляется.
					</Item>
					<Item event="Оплата">
						Кнопка "Рассчитать" вызывает модальное окно выбора вида оплаты (Наличные / Карта).
						После выбора создается документ "ЧекККМ".
					</Item>
				</Items>
			</Block>

			<Block name="Interface">
				<Items>
					<Item>Динамическая панель "Быстрые товары" (кнопки на экране).</Item>
					<Item>Адаптация под сканер штрихкодов (перехват ввода).</Item>
				</Items>
			</Block>

			<Block name="History">
				<Record date="2025-10-15">Внедрение глобального поиска и панели быстрых товаров.</Record>
				<Record date="2026-01-15">Адаптация под Украину: Логика акцизных марок, Интерактивное открытие смены.</Record>
			</Block>
		</Object>
	
	</DataProcessors>

    <InformationRegisters>
		<Object name="Штрихкоды" synonym="Штрихкоды номенклатуры">
			<Block name="Purpose">
				<Content>Хранение штрихкодов для идентификации товаров сканером.</Content>
			</Block>
			<Block name="DataModel">
				<Fields>
					<Field name="Штрихкод" type="Строка(200)">Ключевое поле поиска.</Field>
					<Field name="Владелец" type="Справочник.Номенклатура, Справочник.Кассы">Объект, которому принадлежит код.</Field>
				</Fields>
			</Block>
			<Block name="Logic">
				<Items>
					<Item>Допускаются неуникальные штрихкоды (коллизии). Механизм поиска обрабатывает это выводом списка выбора.</Item>
				</Items>
			</Block>
		</Object>

		<Object name="ЦеныНоменклатуры" synonym="Цены номенклатуры">
			<Block name="Purpose">
				<Content>Хранение розничных цен. Периодический (в пределах дня).</Content>
			</Block>
			<Block name="DataModel">
				<Fields>
					<Field name="Период" type="Дата">Дата установки цены.</Field>
					<Field name="Номенклатура" type="Справочник.Номенклатура">Товар.</Field>
					<Field name="Цена" type="Число(15,2)">Стоимость.</Field>
				</Fields>
			</Block>
		</Object>

	
    </InformationRegisters>

    <AccumulationRegisters>
		<Object name="ОстаткиТоваров" synonym="Остатки товаров">
			<Block name="Purpose">
				<Content>Учет количественных остатков на складах.</Content>
			</Block>
			<Block name="DataModel">
				<Fields>
					<Field type="Dimension" name="Склад">Место хранения.</Field>
					<Field type="Dimension" name="Номенклатура">Товар.</Field>
					<Field type="Resource" name="Количество">Остаток.</Field>
				</Fields>
			</Block>
		</Object>

		<Object name="Продажи" synonym="Продажи (Обороты)">
			<Block name="Purpose">
				<Content>Фиксация выручки и себестоимости.</Content>
			</Block>
			<Block name="DataModel">
				<Fields>
					<Field type="Resource" name="Сумма">Выручка.</Field>
					<Field type="Resource" name="Себестоимость">Закупочная стоимость.</Field>
				</Fields>
			</Block>
		</Object>
	
    </AccumulationRegisters>

    <CommonModules>
		<Object name="ОбщегоНазначенияКлиент" synonym="Общего назначения (Клиент)">
			<Block name="Purpose">
				<Content>Глобальные клиентские алгоритмы, доступные из любой формы.</Content>
			</Block>
			<Block name="Logic">
				<Items>
					<Item method="НайтиИОбработатьТовар(Штрихкод, Оповещение)">
						Входная точка алгоритма поиска.
						1. Ищет штрихкод. 
						2. Если найдено несколько — открывает список выбора. 
						3. Если не найдено — ищет по Артикулу/Коду.
						4. Возвращает ссылку в ОбработчикОповещения.
					</Item>
				</Items>
			</Block>
			<Block name="History">
				<Record date="2025-10-15">Создан для реализации архитектуры "Тонкий клиент".</Record>
			</Block>
		</Object>
	
    </CommonModules>

</Configuration>


