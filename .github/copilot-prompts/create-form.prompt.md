# Создание формы для объекта метаданных

## Входные данные
- Объект-владелец: {{ТИП}}.{{ИМЯ}} (например Document.ЧекККМ, Catalog.Номенклатура)
- Имя формы: {{ИМЯ_ФОРМЫ}} (например ФормаДокумента, ФормаЭлемента)
- Тип формы: документ / справочник / обработка

## Алгоритм (выполнить ВСЕ шаги)

### Шаг 1: Проверка владельца
1. Прочитать XML объекта-владельца: `Конфигурация/Проверка/{{ПАПКА}}/{{ИМЯ}}.xml`
2. Запомнить UUID владельца (атрибут `uuid` в корневом теге)
3. Запомнить ВСЕ реквизиты и табличные части для размещения на форме
4. Проверить что формы ещё нет в `<ChildObjects>` владельца

### Шаг 2: Обновить XML владельца
1. В `<ChildObjects>` добавить: `<Form>{{ИМЯ_ФОРМЫ}}</Form>`
2. Если это основная форма — заполнить `<DefaultObjectForm>` / `<DefaultListForm>`

### Шаг 3: Создать описатель формы
Файл: `{{ПАПКА}}/{{ИМЯ}}/Forms/{{ИМЯ_ФОРМЫ}}.xml`
```xml
<?xml version="1.0" encoding="UTF-8"?>
<MetaDataObject xmlns="http://v8.1c.ru/8.3/MDClasses"
    xmlns:xr="http://v8.1c.ru/8.3/xcf/readable"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    version="2.20">
	<Form uuid="{{UUID_ФОРМЫ}}" owner="{{UUID_ВЛАДЕЛЬЦА}}">
		<Properties>
			<Name>{{ИМЯ_ФОРМЫ}}</Name>
		</Properties>
	</Form>
</MetaDataObject>
```

### Шаг 4: Создать Form.xml
Файл: `{{ПАПКА}}/{{ИМЯ}}/Forms/{{ИМЯ_ФОРМЫ}}/Ext/Form.xml`

1. Взять шаблон:
   - Для документа: `Документация/Шаблоны/template-form-document.xml`
   - Для справочника: `Документация/Шаблоны/template-form-catalog.xml`
   - Общий: `Документация/Шаблоны/template-form.xml`
2. Заменить плейсхолдеры реальными значениями
3. **Правила нумерации id элементов:**
   - `AutoCommandBar` формы = `-1`
   - Остальные элементы — последовательно с `1`
   - Каждый элемент ввода: основной `N`, ContextMenu `N+1`, ExtendedTooltip `N+2`
   - Таблица: основная `N`, ContextMenu `N+1`, AutoCommandBar `N+2`, ExtendedTooltip `N+3`, SearchStringAddition `N+4`, ViewStatusAddition `N+5`, SearchControlAddition `N+6`
4. Для каждого реквизита объекта — добавить `<InputField>` с `<DataPath>Объект.ИмяРеквизита</DataPath>`
5. Для каждой ТЧ — добавить `<Table>` с колонками

### Шаг 5: Создать Module.bsl
Файл: `{{ПАПКА}}/{{ИМЯ}}/Forms/{{ИМЯ_ФОРМЫ}}/Ext/Form/Module.bsl`

Минимальный шаблон:
```bsl
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#КонецОбласти
```

### Шаг 6: ConfigDumpInfo.xml
Добавить запись формы ВНУТРИ блока владельца:
```xml
<Metadata name="{{ТИП}}.{{ИМЯ}}.Form.{{ИМЯ_ФОРМЫ}}" id="{{UUID_ФОРМЫ}}"/>
```

### Шаг 7: Валидация
1. `get_errors` на Form.xml
2. `get_errors` на Module.bsl
3. `powershell -ExecutionPolicy Bypass -File "Документация\Валидация\validate-config.ps1"`
4. Проверить: все id уникальны, все ContextMenu/ExtendedTooltip на месте
5. Результат: 0 ошибок
