# Создание нового документа 1С

## Входные данные
- Имя документа: {{ИМЯ}}
- Реквизиты шапки: {{РЕКВИЗИТЫ}}
- Табличные части: {{ТЧ}} с колонками
- Движения регистров: {{РЕГИСТРЫ}}
- Подсистема: {{ПОДСИСТЕМА}}

## Алгоритм (выполнить ВСЕ шаги)

### Шаг 1: Проверка
1. Прочитать спецификацию `Документация/Спецификации/ТЕХНИЧЕСКАЯ СПЕЦИФИКАЦИЯ КОНФИГУРАЦИИ PTM (Public Trade Module).xml`
2. Убедиться что документ описан в спецификации
3. Проверить что документа ещё нет в `Конфигурация/Проверка/Configuration.xml`

### Шаг 2: Создание XML объекта
1. Взять шаблон `Документация/Шаблоны/template-document.xml`
2. Скопировать ВЕСЬ заголовок с xmlns
3. Заменить плейсхолдеры `{{...}}` реальными значениями
4. UUID: сгенерировать для объекта, каждого реквизита, каждой ТЧ, каждой колонки ТЧ
5. Заполнить `<RegisterRecords>` для каждого регистра из {{РЕГИСТРЫ}}
6. Сохранить: `Конфигурация/Проверка/Documents/{{ИМЯ}}.xml`

### Шаг 3: Структура папок
Создать:
```
Documents/{{ИМЯ}}/
  Ext/
    ObjectModule.bsl    ← модуль объекта (обработка проведения)
```

### Шаг 4: Модуль объекта (ObjectModule.bsl)
```bsl
#Область ОбработкаПроведения

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
    // Движения по регистрам
КонецПроцедуры

#КонецОбласти
```

### Шаг 5: Configuration.xml
1. Открыть `Конфигурация/Проверка/Configuration.xml`
2. Добавить `<Document>{{ИМЯ}}</Document>` в `<ChildObjects>` (алфавитный порядок)

### Шаг 6: ConfigDumpInfo.xml
1. Добавить:
```xml
<Metadata name="Document.{{ИМЯ}}" id="{{UUID}}" configVersion="{{HEX32}}00000000">
    <Metadata name="Document.{{ИМЯ}}.Attribute.{{РЕКВИЗИТ}}" id="{{UUID}}"/>
    <Metadata name="Document.{{ИМЯ}}.TabularSection.{{ТЧ}}" id="{{UUID}}"/>
    <Metadata name="Document.{{ИМЯ}}.TabularSection.{{ТЧ}}.Attribute.{{КОЛОНКА}}" id="{{UUID}}"/>
</Metadata>
```

### Шаг 7: Подсистема
1. Добавить `<xr:Item>Document.{{ИМЯ}}</xr:Item>` в нужную подсистему

### Шаг 8: Форма документа
1. Использовать prompt `create-form.prompt.md` с параметром `тип=документ`

### Шаг 9: Валидация
1. `get_errors` на `Documents/{{ИМЯ}}.xml`
2. `get_errors` на `ObjectModule.bsl`
3. `powershell -ExecutionPolicy Bypass -File "Документация\Валидация\validate-config.ps1"`
4. Результат: 0 ошибок

### Шаг 10: Спецификация
1. Обновить блок документа в спецификации
2. Добавить `<Record date="YYYY-MM-DD">Создан документ {{ИМЯ}}</Record>`
