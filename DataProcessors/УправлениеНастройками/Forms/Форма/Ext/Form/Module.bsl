// ============================================================================
// ФОРМА ОБРАБОТКИ: Управление настройками
// Назначение: Удобный интерфейс для изменения настроек по умолчанию
// ============================================================================

#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// Загружаем текущие настройки из регистра
	ЗагрузитьНастройки();
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура Сохранить(Команда)
	
	СохранитьНастройкиНаСервере();
	Оповестить("ИзмененыНастройкиПоУмолчанию");
	ПоказатьПредупреждение(, "Настройки сохранены");
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ЗагрузитьНастройки()
	
	// Читаем настройки используя API
	ОсновнойСклад = НастройкиПоУмолчанию.ПолучитьОсновнойСклад();
	ОсновнойПоставщик = НастройкиПоУмолчанию.ПолучитьОсновногоПоставщика();
	ОсновнаяКасса = НастройкиПоУмолчанию.ПолучитьОсновнуюКассу();
	ОсновнойТипЦен = НастройкиПоУмолчанию.ПолучитьОсновнойТипЦен();
	ПорядокОкругленияЦен = НастройкиПоУмолчанию.ПолучитьПорядокОкругленияЦен();
	КонтролироватьОстаткиПриСписании = НастройкиПоУмолчанию.ПолучитьКонтрольОстатков();
	КоличествоКнопокВКолонке = НастройкиПоУмолчанию.ПолучитьКоличествоКнопокВКолонке();
	КоличествоКнопокВРяду = НастройкиПоУмолчанию.ПолучитьКоличествоКнопокВРяду();
	ШиринаКнопок = НастройкиПоУмолчанию.ПолучитьШиринуКнопок();
	ВысотаКнопок = НастройкиПоУмолчанию.ПолучитьВысотуКнопок();
	
	// Если настройки не заданы - инициализируем
	Если ОсновнойСклад = Неопределено Тогда
		ИнициализироватьЗначенияПоУмолчанию();
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура СохранитьНастройкиНаСервере()
	
	// Сохраняем каждую настройку через API
	НастройкиПоУмолчанию.УстановитьЗначениеНастройки(Справочники.НастройкиПоУмолчанию.ОсновнойСклад, ОсновнойСклад);
	НастройкиПоУмолчанию.УстановитьЗначениеНастройки(Справочники.НастройкиПоУмолчанию.ОсновнойПоставщик, ОсновнойПоставщик);
	НастройкиПоУмолчанию.УстановитьЗначениеНастройки(Справочники.НастройкиПоУмолчанию.ОсновнаяКасса, ОсновнаяКасса);
	НастройкиПоУмолчанию.УстановитьЗначениеНастройки(Справочники.НастройкиПоУмолчанию.ОсновнойТипЦен, ОсновнойТипЦен);
	НастройкиПоУмолчанию.УстановитьЗначениеНастройки(Справочники.НастройкиПоУмолчанию.ПорядокОкругленияЦен, ПорядокОкругленияЦен);
	НастройкиПоУмолчанию.УстановитьЗначениеНастройки(Справочники.НастройкиПоУмолчанию.КонтролироватьОстаткиПриСписании, КонтролироватьОстаткиПриСписании);
	НастройкиПоУмолчанию.УстановитьЗначениеНастройки(Справочники.НастройкиПоУмолчанию.КоличествоКнопокВКолонке, КоличествоКнопокВКолонке);
	НастройкиПоУмолчанию.УстановитьЗначениеНастройки(Справочники.НастройкиПоУмолчанию.КоличествоКнопокВРяду, КоличествоКнопокВРяду);
	НастройкиПоУмолчанию.УстановитьЗначениеНастройки(Справочники.НастройкиПоУмолчанию.ШиринаКнопок, ШиринаКнопок);
	НастройкиПоУмолчанию.УстановитьЗначениеНастройки(Справочники.НастройкиПоУмолчанию.ВысотаКнопок, ВысотаКнопок);
	
КонецПроцедуры

&НаСервере
Процедура ИнициализироватьЗначенияПоУмолчанию()
	
	// Пытаемся получить первый элемент из справочников
	
	// Основной склад
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ ПЕРВЫЕ 1 Ссылка ИЗ Справочник.Склады";
	Результат = Запрос.Выполнить();
	Если НЕ Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Выборка.Следующий();
		ОсновнойСклад = Выборка.Ссылка;
	КонецЕсли;
	
	// Основной поставщик
	Запрос.Текст = "ВЫБРАТЬ ПЕРВЫЕ 1 Ссылка ИЗ Справочник.Контрагенты";
	Результат = Запрос.Выполнить();
	Если НЕ Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Выборка.Следующий();
		ОсновнойПоставщик = Выборка.Ссылка;
	КонецЕсли;
	
	// Основная касса
	Запрос.Текст = "ВЫБРАТЬ ПЕРВЫЕ 1 Ссылка ИЗ Справочник.Кассы";
	Результат = Запрос.Выполнить();
	Если НЕ Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Выборка.Следующий();
		ОсновнаяКасса = Выборка.Ссылка;
	КонецЕсли;
	
	// Основной тип цен
	Запрос.Текст = "ВЫБРАТЬ ПЕРВЫЕ 1 Ссылка ИЗ Справочник.ТипыЦен";
	Результат = Запрос.Выполнить();
	Если НЕ Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		Выборка.Следующий();
		ОсновнойТипЦен = Выборка.Ссылка;
	КонецЕсли;
	
	// Порядок округления - по умолчанию до копеек
	ПорядокОкругленияЦен = Перечисления.ПорядкиОкругленияЦен.ДоКопеек;
	
	// Контроль остатков - по умолчанию включен
	КонтролироватьОстаткиПриСписании = Истина;
	
	// Количество кнопок в колонке - по умолчанию 4
	КоличествоКнопокВКолонке = 4;
	
	// Количество кнопок в ряду - по умолчанию 3
	КоличествоКнопокВРяду = 3;
	
	// Ширина кнопок - по умолчанию 100 пиксели
	ШиринаКнопок = 100;
	
	// Высота кнопок - по умолчанию 80 пиксели
	ВысотаКнопок = 80;
	
КонецПроцедуры

#КонецОбласти
