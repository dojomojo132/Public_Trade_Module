// =================================================================================
// ОБРАБОТКА: Тестовая настройка касс
// Назначение: Создание и настройка тестовых касс
// =================================================================================

Процедура СоздатьИНастроитьКассы() Экспорт
	
	// Проверяем наличие касс
	КоличествоКасс = ПолучитьКоличествоКасс();
	
	Если КоличествоКасс >= 2 Тогда
		Сообщить("Кассы уже созданы. Количество: " + КоличествоКасс);
		Возврат;
	КонецЕсли;
	
	// Очищаем существующие кассы (если есть)
	ОчиститьКассы();
	
	// Создаем 2 кассы
	Касса1 = СоздатьКассу("Касса №1", "001");
	Касса2 = СоздатьКассу("Касса №2", "002");
	
	Если Касса1 <> Неопределено И Касса2 <> Неопределено Тогда
		Сообщить("Кассы успешно созданы:");
		Сообщить("  - " + Касса1.Наименование + " (Код: " + Касса1.Код + ")");
		Сообщить("  - " + Касса2.Наименование + " (Код: " + Касса2.Код + ")");
	Иначе
		Сообщить("Ошибка при создании касс!");
	КонецЕсли;
	
КонецПроцедуры

Функция ПолучитьКоличествоКасс()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	КОЛИЧЕСТВО(Кассы.Ссылка) КАК Количество
		|ИЗ
		|	Справочник.Кассы КАК Кассы
		|ГДЕ
		|	НЕ Кассы.ПометкаУдаления";
	
	Результат = Запрос.Выполнить();
	Если Результат.Пустой() Тогда
		Возврат 0;
	КонецЕсли;
	
	Выборка = Результат.Выбрать();
	Выборка.Следующий();
	
	Возврат Выборка.Количество;
	
КонецФункции

Процедура ОчиститьКассы()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	Кассы.Ссылка КАК Касса
		|ИЗ
		|	Справочник.Кассы КАК Кассы
		|ГДЕ
		|	НЕ Кассы.Предопределенный";
	
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		Попытка
			КассаОбъект = Выборка.Касса.ПолучитьОбъект();
			КассаОбъект.Удалить();
		Исключение
			Сообщить("Ошибка удаления кассы: " + ОписаниеОшибки());
		КонецПопытки;
	КонецЦикла;
	
КонецПроцедуры

Функция СоздатьКассу(Наименование, Код)
	
	Попытка
		НоваяКасса = Справочники.Кассы.СоздатьЭлемент();
		НоваяКасса.Наименование = Наименование;
		НоваяКасса.Код = Код;
		НоваяКасса.Записать();
		
		Возврат НоваяКасса.Ссылка;
	Исключение
		Сообщить("Ошибка создания кассы '" + Наименование + "': " + ОписаниеОшибки());
		Возврат Неопределено;
	КонецПопытки;
	
КонецФункции
