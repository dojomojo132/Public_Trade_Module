
&НаКлиенте
Процедура ПутьКФайлуDBFПриИзменении(Команда)
	// Проверяем, что файл выбран
    Если ЗначениеЗаполнено(ПутьКФайлуDBF) Тогда
        // Вызов функции для обработки DBF файла
        ОбработатьDBFФайл();
	КонецЕсли;

КонецПроцедуры

&НаСервере
Процедура ОбработкаМассиваЗаписей(Массив)

	Для Каждого ЭлементМассивы Из Массив Цикл
			Номенклатура_Модуль.СозданиеНовойНоменклатуры(ЭлементМассивы);		
	КонецЦикла;

КонецПроцедуры // ОбработкаМассиваЗаписей()


// Процедура для обработки DBF файла
&НаКлиенте
Процедура ОбработатьDBFФайл()
    // Вызываем серверную функцию для преобразования DBF в массив
    МассивЗаписей = DBFВМассив(ПутьКФайлуDBF);
    
    // Пример вывода результата
    Если МассивЗаписей.Количество() > 0 Тогда
		ОбработкаМассиваЗаписей(МассивЗаписей);		
		Сообщить("Файл обработан, количество записей: " + МассивЗаписей.Количество());
        // Здесь можно вывести данные, например, в таблицу на форме
    Иначе
        Сообщить("Файл пуст или не удалось обработать!");
    КонецЕсли;
КонецПроцедуры

// Функция преобразует данные из DBF файла в массив структур
// Параметры:
//   ПутьКФайлуDBF - строка, полный путь к файлу DBF
// Возвращает:
//   Массив - массив структур, где каждая структура содержит поля записи DBF

&НаСервере
Функция DBFВМассив(ПутьКФайлуDBF)
    Результат = Новый Массив;
    
    Попытка
        DBF = Новый XBase;
        DBF.ОткрытьФайл(ПутьКФайлуDBF);
    Исключение
        Сообщить("Ошибка при открытии файла DBF: " + ОписаниеОшибки());
        Возврат Результат;
    КонецПопытки;
    
    Если НЕ DBF.Открыта() Тогда
        Сообщить("Не удалось открыть файл DBF!");
        Возврат Результат;
    КонецЕсли;
    
    ПоляDBF = Новый Структура;
    Для Каждого Поле Из DBF.Fields Цикл
        ПоляDBF.Вставить(Поле.Имя, Поле.Имя);
    КонецЦикла;
    
    Пока НЕ DBF.ВКонце() Цикл
        ТекущаяЗапись = Новый Структура;
        Для Каждого Поле Из ПоляDBF Цикл
            ЗначениеПоля = DBF.ПолучитьЗначениеПоля(Поле.Ключ);
            ТекущаяЗапись.Вставить(Поле.Ключ, ЗначениеПоля);
        КонецЦикла;
        Результат.Добавить(ТекущаяЗапись);
        DBF.Следующая();
    КонецЦикла;
    
    DBF.ЗакрытьФайл();
    
    Возврат Результат;  
	
КонецФункции

&НаКлиенте
Процедура ПутьКФайлуDBFНачалоВыбора(Элемент, ДанныеВыбора, ВыборДобавлением, СтандартнаяОбработка)

	Проводник = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	Проводник.Заголовок = "Выберите файл";
	//Проводник.Фильтр 
	
	Оповещение = Новый ОписаниеОповещения("ПослеВыбораФайла", ЭтотОбъект);  
	Проводник.Показать(Оповещение);
	
КонецПроцедуры                      

// <Описание процедуры>
//
// Параметры:
//  <Параметр1>  - <Тип.Вид> - <описание параметра>
//                 <продолжение описания параметра>
//  <Параметр2>  - <Тип.Вид> - <описание параметра>
//                 <продолжение описания параметра>
//
&НаКлиенте
Процедура ПослеВыбораФайла(ВыбранныйФайл, ДополнительныеПараметры) Экспорт 

	Если ВыбранныйФайл = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	ПутьКФайлуDBF = ВыбранныйФайл[0];

КонецПроцедуры // ПослеВыбораФайла()

