&НаКлиенте
Процедура ЗарегистрироватьПодписчиков(Команда)        
	ЗарегистрироватьПодписчиковНаСервере();
КонецПроцедуры

&НаСервере
Процедура ЗарегистрироватьПодписчиковНаСервере()
    Попытка
        Запрос = Новый Запрос;
        Запрос.Текст = 
        "ВЫБРАТЬ
        |   ОбработчикиСобытий.Событие КАК Событие,
        |   ОбработчикиСобытий.ИдентификаторПодписчика КАК ИдентификаторПодписчика,
        |   ОбработчикиСобытий.Обработчик КАК Обработчик,
        |   ОбработчикиСобытий.КодОбработчика КАК КодОбработчика
        |ИЗ
        |   Справочник.ОбработчикиСобытий КАК ОбработчикиСобытий
        |ГДЕ
        |   НЕ ОбработчикиСобытий.ПометкаУдаления";
        
        Выборка = Запрос.Выполнить().Выбрать();
        
        Пока Выборка.Следующий() Цикл
            Если Выборка.Событие.Пустая() Тогда
                ЗаписьЖурналаРегистрации("EventBus.Ошибка", 
                    УровеньЖурналаРегистрации.Ошибка, , , 
                    "Пустое событие для подписчика: " + Выборка.ИдентификаторПодписчика);
                Продолжить;
            КонецЕсли;
            
            Если ПустаяСтрока(Выборка.КодОбработчика) Тогда
                ЗаписьЖурналаРегистрации("EventBus.Ошибка", 
                    УровеньЖурналаРегистрации.Ошибка, , , 
                    "Пустой код обработчика для подписчика: " + Выборка.ИдентификаторПодписчика);
                Продолжить;
            КонецЕсли;
            
            EventBus.ЗарегистрироватьПодписчика(
                Выборка.Событие, 
                Выборка.Обработчик, 
                Выборка.ИдентификаторПодписчика,
                Выборка.КодОбработчика);
        КонецЦикла;
        
        Сообщить("Регистрация подписчиков завершена");
        ЗаписьЖурналаРегистрации("EventBus.Диагностика", 
            УровеньЖурналаРегистрации.Информация, , , 
            "Регистрация подписчиков завершена в обработке НастройкаРасширений");
    Исключение
        Сообщить("Ошибка при регистрации подписчиков: " + ОписаниеОшибки());
        ЗаписьЖурналаРегистрации("EventBus.Ошибка", 
            УровеньЖурналаРегистрации.Ошибка, , , 
            "Ошибка при регистрации подписчиков: " + ОписаниеОшибки());
    КонецПопытки;
КонецПроцедуры