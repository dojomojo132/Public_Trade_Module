ТЕХНИЧЕСКАЯ СПЕЦИФИКАЦИЯ КОНФИГУРАЦИИ "PTM" (Public Trade Module)

Модуль: Учетный контур (Back-office)
ЧАСТЬ 1. Нормативно-справочная информация (НСИ)
1.1. Справочник "Номенклатура"

Центральный объект учета товаров.

    Реквизиты:

        Артикул (Строка, 25) — Поисковый код/SKU. Автозаполнение: При записи, если поле пустое, оно автоматически заполняется значением системного поля "Код".

        ЕдиницаИзмерения (Перечисление: шт, кг, л, уп).

        СтавкаНДС (Перечисление: 20%, Без НДС).

        НалоговаяГруппа (Справочник) — Привязка к секции ККТ (Важно для гибридного чека).

        КодУКТЗЕД (Строка, 20) — Код для акцизных накладных/чеков.

        ТребуетАкцизнуюМарку (Булево) — Флаг контроля маркировки.

        ПроцентНаценки (Число, 5.2) — NEW! Плановая наценка (например, 30%). Используется для авторасчета цены.

1.2. Справочник "Контрагенты"

Поставщики товаров.

    Реквизиты:

        Наименование (Строка, 100).

        Телефон (Строка, 20).

        Комментарий (Строка) — Условия работы (отсрочка/факт).

1.3. Справочник "Склады"

Места хранения.

    Реквизиты:

        ТипСклада (Перечисление: ТорговыйЗал, ОсновнойСклад).

1.4. Настройки и Константы

Глобальные параметры учета.

    ПорядокОкругленияЦен (Перечисление) — NEW!

        Значения: Окр001 (1 коп), Окр010 (10 коп), Окр050 (50 коп), Окр100 (1 грн), ОкрВБольшую (Всегда вверх).

    КонтролироватьОстаткиПриСписании (Булево) — Запрет ухода в минус.
	
	Константа.ОсновнойСклад: Тип СправочникСсылка.Склады. - Склад поумолчанию.

	Константа.ОсновнойПоставщик: Тип СправочникСсылка.Контрагенты. - Контрагент поумолчанию.

ЧАСТЬ 2. Закупки и Ценообразование
2.1. Документ "ПриходТовара"

Фиксация поступления и расчет цен.

    Шапка:

        Поставщик (Спр.Контрагенты).

        Склад (Спр.Склады).

        ВходящийНомер (Строка) — Номер накладной поставщика.

        СуммаДокумента (Число).

    Табличная часть "Товары":

        Номенклатура.

        Количество.

        Цена (Число) — Входная цена.

        Сумма (Число).

        ЦенаРозничнаяТекущая (Число, только просмотр) — Подтягивается из регистра цен на момент создания.

        ЦенаРозничнаяНовая (Число) — NEW! Рассчитывается автоматически.

    Алгоритм "Авто-наценка" (в форме документа):

        При вводе ЦеныЗакупки или Номенклатуры.

        Чтение Номенклатура.ПроцентНаценки.

        Расчет: Цена = ЦенаЗакупки * (1 + Процент/100).

        Округление согласно константе ПорядокОкругленияЦен.

        Если ЦенаРозничнаяНовая <> ЦенаРозничнаяТекущая, строка подсвечивается.

    Движения:

        Приход: РегистрНакопления.ОстаткиТоваров.

        Расход: РегистрНакопления.Взаиморасчеты (Увеличиваем долг перед поставщиком).

        Запись: РегистрСведений.ЦеныЗакупки (Запоминаем последнюю закупочную).

    Ввод на основании:

        Документ Переоценка (Копируются только строки с изменившейся ценой).

2.2. Документ "Переоценка"

Установка розничных цен.

    Табличная часть:

        Номенклатура.

        Цена.

    Движения:

        Запись: РегистрСведений.ЦеныНоменклатуры (Срез последних на дату).

ЧАСТЬ 3. Складская логика

3.1. Документ "СписаниеТовара"

Порча, бой, недостача, собственные нужды.

    Реквизиты: 
        Склад (Спр.Склады).
        ПричинаСписания (Спр.ПричиныСписания) — NEW!

    Справочник "ПричиныСписания" — NEW!
        Назначение: Пользовательская аналитика выбытия товаров.
        Реквизиты: Код, Наименование.
        Предопределенные элементы: Порча, Бой, Недостача.

    Движения:

        Расход: РегистрНакопления.ОстаткиТоваров.
        
    Контроль остатков:
        При проведении выполняется проверка наличия товара на складе (если включена константа "КонтролироватьОстаткиПриСписании").
		
3.2. Документ "ИнвентаризацияТоваров"

Исправление остатков "прямым методом".

    Реквизиты: Склад.

    Табличная часть:

        Номенклатура.

        УчетноеКоличество (Книжный остаток).

        ФактическоеКоличество (Ввод сканером).

        Отклонение (Факт - Учет).

    Движения (при проведении):

        Если Отклонение > 0: Приход в ОстаткиТоваров (Оприходование излишков).

        Если Отклонение < 0: Расход из ОстаткиТоваров (Списание недостач).

ЧАСТЬ 4. Финансы (Касса предприятия)
4.1. Документ "ПриходныйКассовыйОрдер" (ПКО)

Поступление наличных в сейф/кассу.

    Виды операций:

        РозничнаяВыручка (Ввод на основании отчета о закрытии смены).

        ПрочийПриход.

    Движения:

        Приход: РегистрНакопления.ДенежныеСредства.

4.2. Документ "РасходныйКассовыйОрдер" (РКО)

Выдача денег.

    Виды операций:

        ОплатаПоставщику.

        Инкассация (Сдача в банк).

        ВыдачаВКассуККМ (Разменная монета).

        ПрочийРасход (Зарплата, Аренда).

    Движения:

        Расход: РегистрНакопления.ДенежныеСредства.

        Если операция ОплатаПоставщику: Приход в РегистрНакопления.Взаиморасчеты (Гашение долга).

ЧАСТЬ 5. Система Лояльности (Lite)
5.1. Справочники

    ВидыДисконтныхКарт: ПроцентСкидки, ПорогНакопления (сумма для перехода на след. уровень), СледующийУровень.

    ДисконтныеКарты: Штрихкод, Телефон, ФИО, ВидКарты, ТекущаяСуммаНакоплений.

5.2. Интеграция в продажи

    В чек (РМК) добавляется поле карты.

    При проведении продажи (Чек ККМ) делается запись в регистр оборотов ПродажиПоДисконтнымКартам.

    Регламентное задание (или при проведении): Если накопления превысили порог -> Сменить ВидКарты в справочнике.

ЧАСТЬ 6. Структура Регистров (База данных)
6.1. Регистры накопления (Остатки)

    ОстаткиТоваров

        Измерения: Склад, Номенклатура.

        Ресурсы: Количество.

    Взаиморасчеты

        Измерения: Контрагент.

        Ресурсы: Сумма (Наш долг перед ними).

    ДенежныеСредства

        Измерения: Касса (Место хранения денег).

        Ресурсы: Сумма.

6.2. Регистры накопления (Обороты)

    ПродажиПоДисконтнымКартам

        Измерения: ДисконтнаяКарта.

        Ресурсы: Сумма.

6.3. Регистры сведений

    ЦеныНоменклатуры (Периодический: День).

        Измерения: Номенклатура.

        Ресурсы: Цена.

    ЦеныЗакупки (Периодический: День).

        Измерения: Номенклатура.

        Ресурсы: Цена.

    Штрихкоды (Непериодический).

        Измерения: Штрихкод.

        Ресурсы: Номенклатура, ЕдиницаИзмерения.
		
ЧАСТЬ 7. Служебные инструменты

	7.1. Обработка "ЗаполнениеНоменклатуры"
    
		Назначение: Генерация тестового набора данных (Товары, Налоговые группы).
    
		Функции: Создание товаров 3-х типов (Обычный, Социальный, Акцизный).
	
	7.2. Глобальные алгоритмы (ОбщегоНазначения) — NEW! Функция: НайтиТовар(СтрокаПоиска). Назначение: Универсальный поиск для всех форм (РМК, Документы). Логика:

    Поиск точного совпадения в регистре "Штрихкоды".

    Если не найдено — поиск по справочнику "Номенклатура" (поля Код или Артикул).

    Результат: Ссылка (если 1), Список (если >1), или Неопределено.

ЧАСТЬ 8. Розничная торговля (Front-office)

Модуль: Рабочее место кассира (РМК) и фискализация

8.1. Документ "КассоваяСмена" Управление сессией кассира. Блокирует возможность продажи без открытия смены.

    Реквизиты:

        Касса (Спр.Кассы).

        Статус (Перечисление: Открыта, Закрыта).

        НачалоСмены (Дата/Время).

        ОкончаниеСмены (Дата/Время).

8.2. Документ "ЧекККМ" (Мастер-документ) Единый документ продажи для покупателя. Оформляется в интерфейсе РМК.

    Шапка:

        Касса (Спр.Кассы).

        КассоваяСмена (Док.КассоваяСмена).

        Склад (Спр.Склады).

        ДисконтнаяКарта (Спр.ДисконтныеКарты) — Клиент.

        Статус (Перечисление: Пробит, Отложен, Аннулирован).

        СуммаДокумента (Число) — Итого к оплате.

    Табличная часть "Товары":

        Номенклатура.

        Количество.

        Цена (Розничная).

        СуммаСкидки (Число) — Рассчитанная скидка.

        Сумма (Число) — Конечная сумма строки.

        НалоговаяГруппа (Спр.НалоговыеГруппы) — NEW! Берется из карточки товара (ОСН, Патент, Акциз).

        АкцизнаяМарка (Строка, 200) — NEW! Код DataMatrix для маркированных товаров.

    Табличная часть "Оплата" (Смешанная оплата):

        ВидОплаты (Перечисление: Наличные, Карта, Бонусы).

        Сумма.

    Движения:

        Расход: РегистрНакопления.ОстаткиТоваров.

        Приход: РегистрНакопления.Продажи (Выручка).

        Приход: РегистрНакопления.ДенежныеСредства (Пополнение кассы).

8.3. Документ "ФискальныйЧек" (Технический) Подтверждение регистрации операции в конкретном фискальном регистраторе (ККТ). Формируется автоматически при проведении ЧекаККМ.

    Реквизиты:

        ДокументОснование (Док.ЧекККМ).

        Оборудование (Спр.КассовоеОборудование) — Какая именно касса пробила.

        НомерЧекаККМ (Строка) — Номер чека внутри "железки".

        ФискальныйПризнак (Строка) — Уникальный код ФПД из ОФД.

    Логика "Гибридная фискализация":

        При пробитии "Чека ККМ" система группирует товары по НалоговойГруппе.

        Для каждой группы ищется оборудование (см. п. 8.4).

        Один "Чек ККМ" может породить несколько "Фискальных чеков" (например, Алкоголь -> Касса ООО, Хлеб -> Касса ИП).

8.4. Справочники и Настройки

    Справочник "НалоговыеГруппы"

        Назначение: Классификация товаров для разделения выручки.

        Примеры: "Акцизный товар", "Товары ИП (Без НДС)", "Товары ООО (НДС 20%)".

    Регистр сведений "НастройкиРаспределенияПродаж"

        Назначение: Маршрутизация печати чеков.

        Измерения: Касса + НалоговаяГруппа.

        Ресурсы: Оборудование (Куда печатать).

8.5. Регистр накопления "Продажи" (Обороты) Аналитика выручки и валовой прибыли.

    Измерения:

        Номенклатура.

        Касса.

        КассоваяСмена.

        Сотрудник (Пользователь).

    Ресурсы:

        Количество.

        Сумма (Выручка).

        Себестоимость (Закупочная цена на момент продажи).

8.6. Алгоритм работы с Маркировкой (Честный Знак / ЕГАИС)

    При добавлении товара в чек проверяется флаг Номенклатура.ТребуетАкцизнуюМарку.

    Если Истина: Поле ввода блокируется, появляется окно "Сканируйте марку".

    Марка (DataMatrix) записывается в ТЧ "Товары".

    При фискализации марка передается в драйвер ККТ (тег 1162).




Данная структура полностью закрывает потребности учета "Магазина у дома":

    Товарный контур замкнут (Приход - Склад - Продажа - Списание).

    Финансовый контур замкнут (Долг поставщику - Касса - Оплата).

    Маркетинг есть (накопительные карты).

    Автоматизация рутины (авто-наценка) реализована.