# Синтаксис 1C:Enterprise 8.3.24

## КРИТИЧНО: Асинхронность (Обязательно!)

### Правильно — Асинх/Ждать
```bsl
// Клиентский код — ТОЛЬКО асинхронный
&НаКлиенте
Асинх Процедура ОткрытьФормуТовара(Команда)
    ПараметрыФормы = Новый Структура("Ключ", ТекущийТовар);
    Результат = Ждать ОткрытьФормуАсинх("Справочник.Номенклатура.ФормаОбъекта", ПараметрыФормы);
    Если Результат <> Неопределено Тогда
        ОбновитьДанные();
    КонецЕсли;
КонецПроцедуры
```

### ЗАПРЕЩЕНО — Модальные вызовы
```bsl
// НЕ ИСПОЛЬЗОВАТЬ! Устарело в 8.3.24
Ответ = Вопрос("Продолжить?", РежимДиалогаВопрос.ДаНет);  // ОШИБКА!
ВыбранныйФайл = ОткрытьФайл();  // ОШИБКА!
```

### Альтернатива через ОписаниеОповещения
```bsl
&НаКлиенте
Процедура ЗадатьВопросПользователю()
    Оповещение = Новый ОписаниеОповещения("ПослеОтветаНаВопрос", ЭтотОбъект);
    ПоказатьВопрос(Оповещение, "Продолжить операцию?", РежимДиалогаВопрос.ДаНет);
КонецПроцедуры

&НаКлиенте
Процедура ПослеОтветаНаВопрос(Результат, ДопПараметры) Экспорт
    Если Результат = КодВозвратаДиалога.Да Тогда
        ВыполнитьОперацию();
    КонецЕсли;
КонецПроцедуры
```

---

## Директивы компиляции

| Директива | Контекст | Пример использования |
|-----------|----------|---------------------|
| `&НаКлиенте` | Тонкий/Веб-клиент | UI-логика, оповещения |
| `&НаСервере` | Сервер | Запросы к БД, расчеты |
| `&НаСервереБезКонтекста` | Сервер (без формы) | Чистые функции |
| `&НаКлиентеНаСервереБезКонтекста` | Оба | Утилиты форматирования |

---

## Работа с запросами

```bsl
&НаСервереБезКонтекста
Функция ПолучитьОстатокТовара(Номенклатура, Склад, Дата)
    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ
    |   ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК Остаток
    |ИЗ
    |   РегистрНакопления.ОстаткиТоваров.Остатки(&Дата, 
    |       Номенклатура = &Номенклатура И Склад = &Склад) КАК ОстаткиТоваровОстатки";
    
    Запрос.УстановитьПараметр("Дата", Дата);
    Запрос.УстановитьПараметр("Номенклатура", Номенклатура);
    Запрос.УстановитьПараметр("Склад", Склад);
    
    Результат = Запрос.Выполнить();
    Если Результат.Пустой() Тогда
        Возврат 0;
    КонецЕсли;
    
    Выборка = Результат.Выбрать();
    Выборка.Следующий();
    Возврат Выборка.Остаток;
КонецФункции
```

---

## Обработка проведения документа

```bsl
Процедура ОбработкаПроведения(Отказ, РежимПроведения)
    
    // 1. Формирование движений
    Движения.ОстаткиТоваров.Записывать = Истина;
    
    Для Каждого СтрокаТовары Из Товары Цикл
        Движение = Движения.ОстаткиТоваров.Добавить();
        Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
        Движение.Период = Дата;
        Движение.Номенклатура = СтрокаТовары.Номенклатура;
        Движение.Склад = Склад;
        Движение.Количество = СтрокаТовары.Количество;
    КонецЦикла;
    
    // 2. Контроль остатков (если включен)
    Если Константы.КонтролироватьОстаткиПриСписании.Получить() Тогда
        ПроверитьОстатки(Отказ);
    КонецЕсли;
    
КонецПроцедуры
```

---

## Типовые конструкции

### Создание документа программно
```bsl
НовыйЧек = Документы.ЧекККМ.СоздатьДокумент();
НовыйЧек.Дата = ТекущаяДата();
НовыйЧек.Касса = ПараметрыСеанса.ТекущаяКасса;
НовыйЧек.КассоваяСмена = ТекущаяСмена;
НовыйЧек.Склад = Константы.ОсновнойСклад.Получить();

НоваяСтрока = НовыйЧек.Товары.Добавить();
НоваяСтрока.Номенклатура = ВыбранныйТовар;
НоваяСтрока.Количество = 1;
НоваяСтрока.Цена = ПолучитьЦену(ВыбранныйТовар);
НоваяСтрока.Сумма = НоваяСтрока.Количество * НоваяСтрока.Цена;

НовыйЧек.Записать(РежимЗаписиДокумента.Проведение);
```

### Получение среза регистра сведений
```bsl
Отбор = Новый Структура("Номенклатура, ТипЦен", Товар, ТипыЦен.Розничная);
ДанныеЦены = РегистрыСведений.ЦеныНоменклатуры.ПолучитьПоследнее(ТекущаяДата(), Отбор);
Цена = ?(ДанныеЦены = Неопределено, 0, ДанныеЦены.Цена);
```