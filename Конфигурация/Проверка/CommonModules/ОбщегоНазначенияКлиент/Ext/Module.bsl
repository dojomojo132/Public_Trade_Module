// =============================================================================
// ГЛОБАЛЬНЫЕ КЛИЕНТСКИЕ МЕТОДЫ
// =============================================================================

// Процедура: НайтиИОбработатьТовар
// Назначение: Интерфейсная обертка. Вызывает серверный поиск и обрабатывает выбор пользователя.
// Параметры:
//  Штрихкод    - Строка
//  Оповещение  - ОписаниеОповещения - куда вернуть результат
//
Процедура НайтиИОбработатьТовар(Знач Штрихкод, Оповещение) Экспорт
	
	// 1. Вызов Сервера
	РезультатПоиска = ОбщегоНазначения.НайтиТовар(Штрихкод);
	
	// 2. Логика обработки результата
	
	// А. Не нашли
	Если РезультатПоиска = Неопределено Тогда
		ПоказатьПредупреждение(, "Товар со штрихкодом " + Штрихкод + " не найден!");
		ВыполнитьОбработкуОповещения(Оповещение, Неопределено);
		
	// Б. Нашли один товар (СправочникСсылка)
	ИначеЕсли ТипЗнч(РезультатПоиска) <> Тип("Массив") Тогда
		ВыполнитьОбработкуОповещения(Оповещение, РезультатПоиска);
		
	// В. Нашли несколько (Массив) - Коллизия штрихкодов
	Иначе
		
		СписокВариантов = Новый СписокЗначений;
		СписокВариантов.ЗагрузитьЗначения(РезультатПоиска);
		
		ДопПараметры = Новый Структура;
		ДопПараметры.Вставить("Оповещение", Оповещение);
		
		Оп = Новый ОписаниеОповещения("ПослеВыбораИзСписка", ЭтотОбъект, ДопПараметры);
		
		// --- ИСПРАВЛЕНИЕ ЗДЕСЬ ---
		// Используем метод объекта "СписокЗначений", он работает без привязки к элементу формы
		СписокВариантов.ПоказатьВыборЭлемента(Оп, "Найдено несколько товаров. Выберите нужный:");
		// -------------------------
		
	КонецЕсли;

КонецПроцедуры

// Служебная процедура (Callback выбора)
Процедура ПослеВыбораИзСписка(ВыбранныйЭлемент, Параметры) Экспорт
	
	// ВыбранныйЭлемент - это ЭлементСпискаЗначений или Неопределено (если отказ)
	Результат = ?(ВыбранныйЭлемент <> Неопределено, ВыбранныйЭлемент.Значение, Неопределено);
	ВыполнитьОбработкуОповещения(Параметры.Оповещение, Результат);

КонецПроцедуры