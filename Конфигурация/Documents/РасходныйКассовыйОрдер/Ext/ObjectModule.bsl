Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	
	// 1. Инициализация записи регистров
	Движения.ДенежныеСредства.Записывать = Истина;
	Движения.Взаиморасчеты.Записывать = Истина;
	
	// 2. Расход денежных средств из кассы
	Движение = Движения.ДенежныеСредства.Добавить();
	Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
	Движение.Период = Дата;
	Движение.Касса = Касса;
	Движение.Сумма = СуммаДокумента;
	
	// 3. Погашение задолженности перед контрагентом
	// Приход по регистру Взаиморасчеты = уменьшение долга (компенсирует Расход от ПриходаТовара)
	Если НЕ Контрагент.Пустая() Тогда
		Движение = Движения.Взаиморасчеты.Добавить();
		Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
		Движение.Период = Дата;
		Движение.Контрагент = Контрагент;
		Движение.Сумма = СуммаДокумента;
	КонецЕсли;
	
КонецПроцедуры

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	
	Если ЭтоНовый() И ТипЗнч(ДанныеЗаполнения) = Тип("Неопределено") Тогда
		// Заполняем кассу из настроек по умолчанию
		Если Касса.Пустая() Тогда
			Касса = НастройкиПоУмолчанию.ПолучитьКассуНаличных();
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры
