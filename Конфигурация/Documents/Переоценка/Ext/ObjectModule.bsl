Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	
	// Ввод на основании документа "ПриходТовара"
	Если ТипЗнч(ДанныеЗаполнения) = Тип("ДокументСсылка.ПриходТовара") Тогда
		
		// 1. Очищаем текущие строки (на случай повторного заполнения)
		Товары.Очистить();
		
		// 2. Перебираем строки основания
		Для Каждого СтрокаОснования Из ДанныеЗаполнения.Товары Цикл
			
			// Условие переноса: Цена рассчитана И она отличается от старой
			// (Если ЦенаРозничнаяНовая = 0, значит авторасчета не было или он не нужен)
			НуженПеренос = (СтрокаОснования.ЦенаРозничнаяНовая > 0) 
				И (СтрокаОснования.ЦенаРозничнаяНовая <> СтрокаОснования.ЦенаРозничнаяТекущая);
				
			Если НуженПеренос Тогда
				НоваяСтрока = Товары.Добавить();
				НоваяСтрока.Номенклатура = СтрокаОснования.Номенклатура;
				НоваяСтрока.ЦенаНовая = СтрокаОснования.ЦенаРозничнаяНовая;
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
	
	Для Каждого ТекСтрока Из Товары Цикл
		
		// Проверка на 0 (защита от бесплатных товаров)
		Если ТекСтрока.Цена <= 0 Тогда
			
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Текст = "Цена должна быть больше нуля!";
			Сообщение.Поле = "Товары[" + Товары.Индекс(ТекСтрока) + "].Цена";
			Сообщение.УстановитьДанные(ЭтотОбъект);
			Сообщение.Сообщить();
			
			Отказ = Истина;
			
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
		
	Движения.ЦеныНоменклатуры.Записывать = Истина;
	
	Для Каждого ТекСтрока Из Товары Цикл
		
		Движение = Движения.ЦеныНоменклатуры.Добавить();
		Движение.Период = Дата;
		Движение.Номенклатура = ТекСтрока.Номенклатура;
		Движение.ТипЦен = ТипЦен;
		Движение.Цена = ТекСтрока.Цена;
		
	КонецЦикла;
	
КонецПроцедуры