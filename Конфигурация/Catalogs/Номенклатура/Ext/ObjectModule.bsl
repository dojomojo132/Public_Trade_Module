// =============================================================================
// МОДУЛЬ ОБЪЕКТА: Справочник Номенклатура
// =============================================================================

Процедура ПередЗаписью(Отказ)
	
	//// [Spec-First 1.1] Автозаполнение Артикула из Кода
	//// Если артикул пустой, дублируем в него код товара для упрощения поиска
	//Если ПустаяСтрока(Артикул) И ЗначениеЗаполнено(Код) Тогда
	//	Артикул = Код;
	//КонецЕсли;
	
	// Проверка уникальности штрихкодов внутри табличной части
	ПроверитьУникальностьШтрихкодовВТЧ(Отказ);
	
КонецПроцедуры

Процедура ПослеЗаписи(Отказ)
	
	// Синхронизация штрихкодов с регистром сведений происходит на форме
	// Здесь можно добавить дополнительную логику при необходимости
	
КонецПроцедуры

#Область СлужебныеПроцедурыИФункции

Процедура ПроверитьУникальностьШтрихкодовВТЧ(Отказ)
	
	// Проверка на дублирование штрихкодов внутри табличной части
	СписокШтрихкодов = Новый Соответствие;
	
	Для Каждого СтрокаТЧ Из Штрихкоды Цикл
		
		// Пропускаем пустые штрихкоды
		Если ПустаяСтрока(СокрЛП(СтрокаТЧ.Штрихкод)) Тогда
			Продолжить;
		КонецЕсли;
		
		Штрихкод = ВРег(СокрЛП(СтрокаТЧ.Штрихкод));
		
		// Проверяем дубликаты внутри ТЧ
		Если СписокШтрихкодов[Штрихкод] <> Неопределено Тогда
			
			Отказ = Истина;
			
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Текст = СтрШаблон(
				"Штрихкод ""%1"" дублируется в табличной части!",
				СокрЛП(СтрокаТЧ.Штрихкод));
			Сообщение.Сообщить();
			
			Возврат;
			
		КонецЕсли;
		
		СписокШтрихкодов.Вставить(Штрихкод, Истина);
		
	КонецЦикла;
	
КонецПроцедуры

#КонецОбласти
