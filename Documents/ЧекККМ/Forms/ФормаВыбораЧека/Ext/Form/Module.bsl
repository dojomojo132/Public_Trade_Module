// Модуль формы выбора чека для возврата

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("Склад") И ЗначениеЗаполнено(Параметры.Склад) Тогда
		Склад = Параметры.Склад;
		ЗагрузитьСписокЧеков();
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ЗагрузитьСписокЧеков()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ ПЕРВЫЕ 50
		|	ЧекККМ.Ссылка КАК Чек,
		|	ЧекККМ.Номер КАК Номер,
		|	ЧекККМ.Дата КАК Дата,
		|	ЧекККМ.ТЧ.TotalСумма КАК Сумма
		|ИЗ
		|	Документ.ЧекККМ КАК ЧекККМ
		|ГДЕ
		|	ЧекККМ.Склад = &Склад
		|	И ЧекККМ.Проведен = ИСТИНА
		|	И НЕ ЧекККМ.ПометкаУдаления
		|	И ЧекККМ.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЧекаККМ.Пробит)
		|
		|УПОРЯДОЧИТЬ ПО
		|	ЧекККМ.Дата УБЫВ";
	
	Запрос.УстановитьПараметр("Склад", Склад);
	
	РезультатЗапроса = Запрос.Выполнить();
	СписокЧеков.Загрузить(РезультатЗапроса.Выгрузить());
	
КонецПроцедуры

&НаКлиенте
Процедура СписокЧековВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ТекущиеДанные = Элементы.СписокЧеков.ТекущиеДанные;
	Если ТекущиеДанные <> Неопределено Тогда
		Закрыть(ТекущиеДанные.Чек);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура Выбрать(Команда)
	
	ТекущиеДанные = Элементы.СписокЧеков.ТекущиеДанные;
	Если ТекущиеДанные <> Неопределено Тогда
		Закрыть(ТекущиеДанные.Чек);
	Иначе
		ПоказатьПредупреждение(, "Необходимо выбрать чек из списка!");
	КонецЕсли;
	
КонецПроцедуры
