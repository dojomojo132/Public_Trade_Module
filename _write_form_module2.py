# -*- coding: utf-8 -*-
import pathlib

bsl_code = '''#Область ОбработчикиСобытийФормы

&НаКлиенте
Процедура КонтрагентПриИзменении(Элемент)
\t
\t// При смене контрагента сбрасываем документ основание
\tОбъект.ДокументОснование = Неопределено;
\t
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКоманд

&НаКлиенте
Процедура ВыбратьНеоплаченныеНакладные(Команда)
\t
\tЕсли Объект.Контрагент.Пустая() Тогда
\t\tСообщение = Новый СообщениеПользователю;
\t\tСообщение.Текст = "Необходимо выбрать контрагента";
\t\tСообщение.Поле = "Объект.Контрагент";
\t\tСообщение.Сообщить();
\t\tВозврат;
\tКонецЕсли;
\t
\tСписокНакладных = ПолучитьНеоплаченныеНакладныеНаСервере(Объект.Контрагент);
\t
\tЕсли СписокНакладных.Количество() = 0 Тогда
\t\tПоказатьПредупреждение(, "Неоплаченных накладных не найдено");
\t\tВозврат;
\tКонецЕсли;
\t
\tОписаниеОповещения = Новый ОписаниеОповещения("ОбработатьВыборНакладной", ЭтотОбъект);
\tПоказатьВыборИзСписка(ОписаниеОповещения, СписокНакладных, Элементы.ДокументОснование, "Выберите накладную для оплаты");
\t
КонецПроцедуры

&НаКлиенте
Процедура ОбработатьВыборНакладной(ВыбранныйЭлемент, ДополнительныеПараметры) Экспорт
\t
\tЕсли ВыбранныйЭлемент <> Неопределено Тогда
\t\tОбъект.ДокументОснование = ВыбранныйЭлемент.Значение;
\t\t// Заполняем сумму долга
\t\tОбъект.СуммаДокумента = ПолучитьСуммуДолгаНаСервере(Объект.Контрагент, Объект.ДокументОснование);
\t\tМодифицированность = Истина;
\tКонецЕсли;
\t
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервереБезКонтекста
Функция ПолучитьНеоплаченныеНакладныеНаСервере(Контрагент)
\t
\tЗапрос = Новый Запрос;
\tЗапрос.Текст =
\t"ВЫБРАТЬ
\t|ВзаиморасчетыОстатки.ДокументОснование КАК ДокументОснование,
\t|ВзаиморасчетыОстатки.СуммаОстаток КАК Долг
\t|ИЗ
\t|РегистрНакопления.Взаиморасчеты.Остатки(, Контрагент = &Контрагент) КАК ВзаиморасчетыОстатки
\t|ГДЕ
\t|ВзаиморасчетыОстатки.СуммаОстаток < 0";
\t
\tЗапрос.УстановитьПараметр("Контрагент", Контрагент);
\t
\tРезультат = Запрос.Выполнить();
\tВыборка = Результат.Выбрать();
\t
\tСписокНакладных = Новый СписокЗначений;
\t
\tПока Выборка.Следующий() Цикл
\t\tПредставление = Строка(Выборка.ДокументОснование) + " | Долг: " + Формат(-Выборка.Долг, "ЧГ0=; ЧДЦ=2");
\t\tСписокНакладных.Добавить(Выборка.ДокументОснование, Представление);
\tКонецЦикла;
\t
\tВозврат СписокНакладных;
\t
КонецФункции

&НаСервереБезКонтекста
Функция ПолучитьСуммуДолгаНаСервере(Контрагент, ДокументОснование)
\t
\tЗапрос = Новый Запрос;
\tЗапрос.Текст =
\t"ВЫБРАТЬ
\t|ЕСТЬNULL(ВзаиморасчетыОстатки.СуммаОстаток, 0) КАК Долг
\t|ИЗ
\t|РегистрНакопления.Взаиморасчеты.Остатки(
\t|,
\t|Контрагент = &Контрагент
\t|И ДокументОснование = &ДокументОснование
\t|) КАК ВзаиморасчетыОстатки";
\t
\tЗапрос.УстановитьПараметр("Контрагент", Контрагент);
\tЗапрос.УстановитьПараметр("ДокументОснование", ДокументОснование);
\t
\tРезультат = Запрос.Выполнить();
\tВыборка = Результат.Выбрать();
\t
\tЕсли Выборка.Следующий() Тогда
\t\tВозврат -Выборка.Долг;
\tИначе
\t\tВозврат 0;
\tКонецЕсли;
\t
КонецФункции

#КонецОбласти
'''

paths = [
    pathlib.Path(r"D:\Git\Public_Trade_Module\Конфигурация\Documents\РасходныйКассовыйОрдер\Forms\ФормаДокумента\Ext\Form\Module.bsl"),
    pathlib.Path(r"D:\Git\Public_Trade_Module\Конфигурация\Проверка\Documents\РасходныйКассовыйОрдер\Forms\ФормаДокумента\Ext\Form\Module.bsl"),
]

for p in paths:
    p.parent.mkdir(parents=True, exist_ok=True)
    p.write_text(bsl_code, encoding='utf-8-sig')
    print(f"  OK: {p.parent.parent.parent.parent.name}/{p.name}")

print("\nDone!")
