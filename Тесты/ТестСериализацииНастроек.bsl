// ============================================================================
// ТЕСТОВЫЙ СКРИПТ: Проверка сериализации настроек
// Назначение: Проверка работы ЗначениеВСтроку/СтрокаВЗначение в настройках
// ============================================================================

// Тестируемые типы данных:
// 1. Справочники (ссылки)
// 2. Перечисления
// 3. Булево
// 4. Числа

Процедура ПроверитьСериализациюНастроек()
	
	Сообщить("=== НАЧАЛО ТЕСТА СЕРИАЛИЗАЦИИ НАСТРОЕК ===");
	
	// ========================================
	// ТЕСТ 1: Сохранение и чтение ссылки на справочник
	// ========================================
	Сообщить("");
	Сообщить("ТЕСТ 1: Справочник.Склады");
	
	// Получаем первый склад
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ ПЕРВЫЕ 1 Ссылка ИЗ Справочник.Склады";
	Результат = Запрос.Выполнить();
	Если Результат.Пустой() Тогда
		Сообщить("  ❌ ОШИБКА: Нет складов в базе");
		Возврат;
	КонецЕсли;
	
	Выборка = Результат.Выбрать();
	Выборка.Следующий();
	ТестовыйСклад = Выборка.Ссылка;
	
	Сообщить("  Исходное значение: " + ТестовыйСклад);
	
	// Сохраняем
	НастройкиПоУмолчанию.УстановитьЗначениеНастройки(
		Справочники.НастройкиПоУмолчанию.ОсновнойСклад, 
		ТестовыйСклад
	);
	Сообщить("  ✓ Сохранено через УстановитьЗначениеНастройки()");
	
	// Читаем
	ПолученныйСклад = НастройкиПоУмолчанию.ПолучитьОсновнойСклад();
	Сообщить("  Прочитанное значение: " + ПолученныйСклад);
	
	// Проверяем
	Если ПолученныйСклад = ТестовыйСклад Тогда
		Сообщить("  ✅ ТЕСТ 1 ПРОЙДЕН: Ссылки совпадают");
	Иначе
		Сообщить("  ❌ ТЕСТ 1 ПРОВАЛЕН: Ссылки НЕ совпадают");
	КонецЕсли;
	
	// ========================================
	// ТЕСТ 2: Булево значение
	// ========================================
	Сообщить("");
	Сообщить("ТЕСТ 2: Булево");
	
	ТестовоеЗначение = Истина;
	Сообщить("  Исходное значение: " + ТестовоеЗначение);
	
	НастройкиПоУмолчанию.УстановитьЗначениеНастройки(
		Справочники.НастройкиПоУмолчанию.КонтролироватьОстаткиПриСписании,
		ТестовоеЗначение
	);
	Сообщить("  ✓ Сохранено");
	
	ПолученноеЗначение = НастройкиПоУмолчанию.ПолучитьКонтрольОстатков();
	Сообщить("  Прочитанное значение: " + ПолученноеЗначение);
	
	Если ПолученноеЗначение = ТестовоеЗначение Тогда
		Сообщить("  ✅ ТЕСТ 2 ПРОЙДЕН: Булево значения совпадают");
	Иначе
		Сообщить("  ❌ ТЕСТ 2 ПРОВАЛЕН");
	КонецЕсли;
	
	// ========================================
	// ТЕСТ 3: Числовое значение
	// ========================================
	Сообщить("");
	Сообщить("ТЕСТ 3: Число");
	
	ТестовоеЧисло = 6;
	Сообщить("  Исходное значение: " + ТестовоеЧисло);
	
	НастройкиПоУмолчанию.УстановитьЗначениеНастройки(
		Справочники.НастройкиПоУмолчанию.КоличествоКнопокВКолонке,
		ТестовоеЧисло
	);
	Сообщить("  ✓ Сохранено");
	
	ПолученноеЧисло = НастройкиПоУмолчанию.ПолучитьКоличествоКнопокВКолонке();
	Сообщить("  Прочитанное значение: " + ПолученноеЧисло);
	
	Если ПолученноеЧисло = ТестовоеЧисло Тогда
		Сообщить("  ✅ ТЕСТ 3 ПРОЙДЕН: Числа совпадают");
	Иначе
		Сообщить("  ❌ ТЕСТ 3 ПРОВАЛЕН");
	КонецЕсли;
	
	// ========================================
	// ТЕСТ 4: Перечисление
	// ========================================
	Сообщить("");
	Сообщить("ТЕСТ 4: Перечисление");
	
	ТестовоеПеречисление = Перечисления.ПорядкиОкругленияЦен.ДоКопеек;
	Сообщить("  Исходное значение: " + ТестовоеПеречисление);
	
	НастройкиПоУмолчанию.УстановитьЗначениеНастройки(
		Справочники.НастройкиПоУмолчанию.ПорядокОкругленияЦен,
		ТестовоеПеречисление
	);
	Сообщить("  ✓ Сохранено");
	
	ПолученноеПеречисление = НастройкиПоУмолчанию.ПолучитьПорядокОкругленияЦен();
	Сообщить("  Прочитанное значение: " + ПолученноеПеречисление);
	
	Если ПолученноеПеречисление = ТестовоеПеречисление Тогда
		Сообщить("  ✅ ТЕСТ 4 ПРОЙДЕН: Перечисления совпадают");
	Иначе
		Сообщить("  ❌ ТЕСТ 4 ПРОВАЛЕН");
	КонецЕсли;
	
	// ========================================
	// ТЕСТ 5: Проверка сериализации напрямую
	// ========================================
	Сообщить("");
	Сообщить("ТЕСТ 5: Прямая проверка сериализации");
	
	// Запрос к регистру напрямую
	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	НастройкиПоУмолчанию.ИмяНастройки КАК ИмяНастройки,
	|	НастройкиПоУмолчанию.Значение КАК Значение
	|ИЗ
	|	РегистрСведений.НастройкиПоУмолчанию КАК НастройкиПоУмолчанию";
	
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	
	Сообщить("  Содержимое регистра (сериализованные строки):");
	Пока Выборка.Следующий() Цикл
		Сообщить("    " + Выборка.ИмяНастройки + " = '" + Выборка.Значение + "'");
	КонецЦикла;
	
	Сообщить("");
	Сообщить("=== ТЕСТЫ ЗАВЕРШЕНЫ ===");
	
КонецПроцедуры

// Запускаем тест
ПроверитьСериализациюНастроек();
