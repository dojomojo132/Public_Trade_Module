# 🔷 PTM Scanner Emulator - Инструкция

## ✅ Решение проблемы "сканер без префиксов"

Эмулятор полностью имитирует **USB сканер с режимом Keyboard Emulation** - просто вводит символы и нажимает Enter.

---

## 🚀 Быстрый старт

### Вариант 1: PowerShell (РЕКОМЕНДУЕТСЯ)

**Без установки зависимостей!**

```powershell
# 1. Откройте форму РМК в 1С
# 2. Запустите эмулятор:
.\START.bat

# Или напрямую:
.\ScanSimple.ps1
```

**Интерактивный режим:**
```
Введите штрихкод: 4820000123456
⏳ Через 2 секунды переключитесь на окно 1С...
✅ Отсканировано: 4820000123456
```

**Командная строка:**
```powershell
.\ScanSimple.ps1 -Barcode "4820000123456"
```

---

### Вариант 2: Electron GUI

**Установка (один раз):**
```bash
npm install
```

**Запуск:**
```bash
npm start
# Или через START.bat → [2]
```

**Возможности GUI:**
- Красивый интерфейс
- Быстрые кнопки с тестовыми штрихкодами
- История сканирований
- Хоткей: `Ctrl+Shift+S`

---

## 📋 Как это работает

### Последовательность действий:

```
1. Пользователь вводит штрихкод в эмулятор
           ↓
2. Нажимает Enter или кнопку "Сканировать"
           ↓
3. Эмулятор минимизируется
           ↓
4. Задержка 300ms (переключение на 1С)
           ↓
5. Имитация клавиатурного ввода:
   - Посимвольно вводит штрихкод
   - Нажимает Enter
           ↓
6. Форма РМК получает данные в активном поле
           ↓
7. ПриИзменении() → ОбработкаШтрихкода()
           ↓
8. Товар добавлен в чек ✅
```

### Технические детали:

**PowerShell:**
```powershell
[System.Windows.Forms.SendKeys]::SendWait($char)
# Задержка 10ms между символами
[System.Windows.Forms.SendKeys]::SendWait("{ENTER}")
```

**Electron (robotjs):**
```javascript
robot.typeString(barcode);  // Посимвольный ввод
robot.keyTap('enter');       // Enter
```

---

## ⚙️ Сравнение с USB сканером

| Параметр | USB сканер | PowerShell | Electron |
|----------|-----------|------------|----------|
| Установка | Plug & Play | ✅ Не требуется | ⚠️ npm install |
| Скорость ввода | ⚡ Мгновенно | 🐌 ~10ms/символ | 🐌 ~10ms/символ |
| Prefix/Suffix | Настраивается | ❌ Только Enter | ❌ Только Enter |
| GUI | ❌ Нет | ❌ Консоль | ✅ Красивый UI |
| Хоткеи | ❌ Нет | ❌ Нет | ✅ Ctrl+Shift+S |
| Требует фокус | ✅ Да | ✅ Да | ✅ Да |

---

## 🎯 Тестовые сценарии

### Сценарий 1: Ручное сканирование
```powershell
.\ScanSimple.ps1
# Ввод: 4820000123456
# → Товар добавлен в чек
```

### Сценарий 2: Автоматическое тестирование
```powershell
# Создайте test-barcodes.txt:
4820000123456
4820000654321
5000000000001

# Скрипт автосканирования:
Get-Content test-barcodes.txt | ForEach-Object {
    .\ScanSimple.ps1 -Barcode $_
    Start-Sleep -Seconds 3
}
```

### Сценарий 3: Hotkey в GUI
```
1. Запустить Electron: npm start
2. Нажать Ctrl+Shift+S → окно на первый план
3. Ввести штрихкод
4. Enter → автоматическая отправка в 1С
```

---

## 🔧 Настройка задержек

**Если сканирование не работает - увеличьте задержки:**

**PowerShell (ScanSimple.ps1, строка 19):**
```powershell
Start-Sleep -Milliseconds 300  # ← Увеличьте до 500-1000
```

**Electron (main.js, строка 49):**
```javascript
await sleep(300);  // ← Увеличьте до 500-1000
```

---

## 🆚 Переключение на реальный USB сканер

**Ничего менять не нужно!**

1. Подключите USB сканер
2. Windows определит как "HID Keyboard Device"
3. Откройте РМК
4. Сканируйте товар
5. **Работает сразу!** ✅

**Можно использовать ОДНОВРЕМЕННО:**
- USB сканер (аппаратный)
- PowerShell эмулятор
- Electron GUI

Все три способа работают через одно и то же поле ввода.

---

## 🐛 Устранение проблем

### Проблема: "Символы не вводятся"

**Причина:** Окно 1С не активно

**Решение:**
```powershell
# Увеличьте задержку перед сканированием:
Start-Sleep -Milliseconds 1000  # Вместо 300
```

### Проблема: "Вводятся лишние символы"

**Причина:** Быстрый ввод, поле не успевает

**Решение:**
```powershell
# Увеличьте задержку между символами (строка 24):
Start-Sleep -Milliseconds 20  # Вместо 10
```

### Проблема: "Enter не срабатывает"

**Причина:** Раскладка клавиатуры

**Решение:** Убедитесь, что активна английская раскладка перед запуском

---

## 📦 Сборка .exe (Electron)

```bash
npm run build:win
```

Результат: `dist/PTM Scanner Emulator.exe` (portable, без установки)

---

## 📞 Поддержка

- Документация: `README.md`
- Тесты: `.\START.bat` → [3]
- Вопросы: см. исходный код с комментариями

---

**Версия:** 1.0.0  
**Дата:** 22.01.2026
